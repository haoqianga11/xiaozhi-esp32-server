<mxfile host="65bd71144e">
    <diagram name="xiaozhi-server业务架构" id="xiaozhi-server-business">
        <mxGraphModel dx="1772" dy="907" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="2339" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="xiaozhi-server 业务实现架构图" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="577" y="40" width="500" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="main-app" value="app.py&#xa;主程序入口" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="727" y="120" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="websocket-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;opacity=30;" parent="1" vertex="1">
                    <mxGeometry x="80" y="240" width="720" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="websocket-title" value="WebSocket服务器层 (端口:8000)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="280" y="250" width="320" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="websocket-server" value="WebSocketServer&#xa;• WebSocket连接管理&#xa;• HTTP协议升级&#xa;• 连接状态监控" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="120" y="290" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="connection-handler" value="ConnectionHandler&#xa;• 每连接独立处理&#xa;• 会话状态管理&#xa;• 认证和绑定" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="340" y="290" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="text-processor" value="TextMessageProcessor&#xa;• 消息路由分发&#xa;• JSON解析处理&#xa;• 处理器注册表" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="560" y="290" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="modules-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=30;" parent="1" vertex="1">
                    <mxGeometry x="80" y="380" width="720" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="modules-title" value="核心模块初始化层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="350" y="390" width="200" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="vad-module" value="VAD&#xa;语音活动检测" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="120" y="430" width="100" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="asr-module" value="ASR&#xa;语音识别" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="260" y="430" width="100" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="llm-module" value="LLM&#xa;大语言模型" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="400" y="430" width="100" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="memory-module" value="Memory&#xa;记忆系统" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="540" y="430" width="100" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="intent-module" value="Intent&#xa;意图识别" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="680" y="430" width="100" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="http-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;opacity=30;" parent="1" vertex="1">
                    <mxGeometry x="860" y="240" width="720" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="http-title" value="HTTP服务器层 (端口:8003)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="1060" y="250" width="320" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="http-server" value="SimpleHttpServer&#xa;• aiohttp框架&#xa;• CORS处理&#xa;• 异步请求处理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="900" y="290" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="ota-handler" value="OTAHandler&#xa;• 设备发现服务&#xa;• 固件升级接口&#xa;• 配置下发" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="1120" y="290" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="vision-handler" value="VisionHandler&#xa;• 视觉分析接口&#xa;• 多模态理解&#xa;• JWT认证" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="1340" y="290" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="message-flow-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#1890ff;opacity=30;" parent="1" vertex="1">
                    <mxGeometry x="80" y="580" width="1500" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="message-flow-title" value="消息处理流程层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="740" y="590" width="200" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="text-handlers" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9f9f9;strokeColor=#999999;opacity=50;" parent="1" vertex="1">
                    <mxGeometry x="120" y="640" width="500" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="text-handlers-title" value="文本消息处理器" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="130" y="650" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="hello-handler" value="Hello&#xa;设备认证" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" parent="1" vertex="1">
                    <mxGeometry x="140" y="680" width="70" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="abort-handler" value="Abort&#xa;会话中止" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" parent="1" vertex="1">
                    <mxGeometry x="230" y="680" width="70" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="listen-handler" value="Listen&#xa;监听模式" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" parent="1" vertex="1">
                    <mxGeometry x="320" y="680" width="70" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="iot-handler" value="IoT&#xa;设备控制" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" parent="1" vertex="1">
                    <mxGeometry x="410" y="680" width="70" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="mcp-handler" value="MCP&#xa;协议处理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" parent="1" vertex="1">
                    <mxGeometry x="500" y="680" width="70" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="audio-flow" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9f9f9;strokeColor=#999999;opacity=50;" parent="1" vertex="1">
                    <mxGeometry x="660" y="640" width="400" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="audio-flow-title" value="音频处理流程" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="670" y="650" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="audio-receive" value="接收音频&#xa;receiveAudioHandle" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="680" y="680" width="110" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="vad-process" value="VAD检测&#xa;语音活动" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="810" y="680" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="asr-process" value="ASR识别&#xa;语音转文字" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="910" y="680" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="text-chat" value="文本对话&#xa;startToChat" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" parent="1" vertex="1">
                    <mxGeometry x="1010" y="680" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="dialogue-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9f9f9;strokeColor=#999999;opacity=50;" parent="1" vertex="1">
                    <mxGeometry x="1120" y="640" width="420" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="dialogue-title" value="对话处理层" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="1130" y="650" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="intent-process" value="意图分析&#xa;intentHandler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" parent="1" vertex="1">
                    <mxGeometry x="1140" y="680" width="90" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="llm-chat" value="LLM对话&#xa;chat处理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" parent="1" vertex="1">
                    <mxGeometry x="1250" y="680" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tts-send" value="TTS合成&#xa;sendAudioHandle" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" parent="1" vertex="1">
                    <mxGeometry x="1350" y="680" width="90" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="memory-save" value="记忆保存&#xa;Memory系统" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" parent="1" vertex="1">
                    <mxGeometry x="1460" y="680" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tools-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;opacity=30;" parent="1" vertex="1">
                    <mxGeometry x="80" y="820" width="1500" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="tools-title" value="工具和插件层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="740" y="830" width="200" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="auth-module" value="认证模块&#xa;AuthMiddleware" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="120" y="880" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="config-loader" value="配置加载&#xa;config_loader" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="270" y="880" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tool-handler" value="统一工具处理器&#xa;UnifiedToolHandler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="420" y="880" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="plugin-loader" value="插件加载器&#xa;auto_import_modules" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="590" y="880" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="voiceprint" value="声纹识别&#xa;VoiceprintProvider" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="760" y="880" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="prompt-manager" value="提示词管理&#xa;PromptManager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="930" y="880" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="output-counter" value="输出计数器&#xa;output_counter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="1080" y="880" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="mqtt-gateway" value="MQTT网关&#xa;支持物联网" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="1230" y="880" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="mcp-support" value="MCP支持&#xa;Model Context Protocol" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" parent="1" vertex="1">
                    <mxGeometry x="1380" y="880" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="devices-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#999999;opacity=30;" parent="1" vertex="1">
                    <mxGeometry x="80" y="1040" width="1500" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="devices-title" value="外部设备和客户端层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="740" y="1050" width="200" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="esp32-device" value="ESP32设备&#xa;• WebSocket连接&#xa;• 实时音频传输&#xa;• 固件OTA升级" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="120" y="1090" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="mobile-app" value="移动APP&#xa;• manager-mobile&#xa;• UniApp框架&#xa;• 设备管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="300" y="1090" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="web-client" value="Web客户端&#xa;• manager-web&#xa;• Vue.js框架&#xa;• 控制面板" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="480" y="1090" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="manager-api" value="智控台API&#xa;• manager-api&#xa;• Spring Boot&#xa;• 设备管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="660" y="1090" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="mqtt-device" value="MQTT设备&#xa;• 物联网设备&#xa;• 传感器数据&#xa;• 设备控制" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="840" y="1090" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="third-party" value="第三方服务&#xa;• LLM API&#xa;• TTS/ASR服务&#xa;• 云端存储" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="1020" y="1090" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="mcp-servers" value="MCP服务器&#xa;• Model Context Protocol&#xa;• 扩展服务&#xa;• 工具集成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="1200" y="1090" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="test-tools" value="测试工具&#xa;• test_page.html&#xa;• 性能测试器&#xa;• WebSocket调试" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
                    <mxGeometry x="1390" y="1090" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="flow1" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="main-app" target="websocket-server" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="727" y="180" as="sourcePoint"/>
                        <mxPoint x="210" y="290" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow2" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#60a917;strokeColor=#2D7600;" parent="1" source="main-app" target="http-server" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="927" y="180" as="sourcePoint"/>
                        <mxPoint x="990" y="290" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="websocket-server" target="connection-handler" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="300" y="330" as="sourcePoint"/>
                        <mxPoint x="340" y="330" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="connection-handler" target="text-processor" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="520" y="330" as="sourcePoint"/>
                        <mxPoint x="560" y="330" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow5" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#6a00ff;strokeColor=#3700CC;" parent="1" source="connection-handler" target="vad-module" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="430" y="370" as="sourcePoint"/>
                        <mxPoint x="170" y="430" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow6" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#e85d75;strokeColor=#B20000;" parent="1" source="http-server" target="ota-handler" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1080" y="330" as="sourcePoint"/>
                        <mxPoint x="1120" y="330" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow7" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#e85d75;strokeColor=#B20000;" parent="1" source="http-server" target="vision-handler" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1080" y="330" as="sourcePoint"/>
                        <mxPoint x="1340" y="330" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow8" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#008a00;strokeColor=#005700;" parent="1" source="audio-receive" target="vad-process" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="790" y="705" as="sourcePoint"/>
                        <mxPoint x="810" y="705" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow9" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#008a00;strokeColor=#005700;" parent="1" source="vad-process" target="asr-process" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="890" y="705" as="sourcePoint"/>
                        <mxPoint x="910" y="705" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow10" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#008a00;strokeColor=#005700;" parent="1" source="asr-process" target="text-chat" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="990" y="705" as="sourcePoint"/>
                        <mxPoint x="1010" y="705" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow11" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#0066cc;strokeColor=#004499;" parent="1" source="text-chat" target="intent-process" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1090" y="705" as="sourcePoint"/>
                        <mxPoint x="1140" y="705" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow12" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#0066cc;strokeColor=#004499;" parent="1" source="intent-process" target="llm-chat" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1230" y="705" as="sourcePoint"/>
                        <mxPoint x="1250" y="705" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow13" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#0066cc;strokeColor=#004499;" parent="1" source="llm-chat" target="tts-send" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1330" y="705" as="sourcePoint"/>
                        <mxPoint x="1350" y="705" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow14" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#0066cc;strokeColor=#004499;" parent="1" source="llm-chat" target="memory-save" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1330" y="705" as="sourcePoint"/>
                        <mxPoint x="1460" y="705" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow15" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#8E24AA;startArrow=classic;startFill=1;" parent="1" source="esp32-device" target="websocket-server" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="195" y="1090" as="sourcePoint"/>
                        <mxPoint x="210" y="370" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow16" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#8E24AA;startArrow=classic;startFill=1;" parent="1" source="esp32-device" target="ota-handler" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="270" y="1090" as="sourcePoint"/>
                        <mxPoint x="1210" y="370" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="80" y="1200" width="600" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="legend-title" value="图例说明" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" parent="1" vertex="1">
                    <mxGeometry x="330" y="1210" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend1" value="主程序入口" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="100" y="1250" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend2" value="WebSocket服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="200" y="1250" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend3" value="HTTP服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#666666;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="300" y="1250" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend4" value="核心模块" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="400" y="1250" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend5" value="消息处理器" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="500" y="1250" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend6" value="音频处理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="100" y="1300" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend7" value="对话处理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="200" y="1300" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend8" value="工具插件" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="300" y="1300" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend9" value="外部设备" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="400" y="1300" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="flow-legend1" value="主要数据流" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="520" y="1300" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="flow-line1" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#60a917;strokeColor=#2D7600;" parent="1" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="500" y="1310" as="sourcePoint"/>
                        <mxPoint x="520" y="1310" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow-legend2" value="双向通信" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="520" y="1320" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="flow-line2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#8E24AA;startArrow=classic;startFill=1;" parent="1" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="500" y="1330" as="sourcePoint"/>
                        <mxPoint x="520" y="1330" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="flow-legend3" value="内部调用" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="520" y="1340" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="flow-line3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="500" y="1350" as="sourcePoint"/>
                        <mxPoint x="520" y="1350" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>