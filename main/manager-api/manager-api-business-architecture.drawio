<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2025-09-16T14:20:00.000Z" agent="drawio" etag="xxx" version="24.7.17">
  <diagram name="manager-api业务架构" id="manager-api-business">
    <mxGraphModel dx="1422" dy="899" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="2339" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- 标题 -->
        <mxCell id="title" value="manager-api 业务实现架构图" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="577" y="40" width="500" height="40" as="geometry" />
        </mxCell>

        <!-- Spring Boot 主应用 -->
        <mxCell id="main-app" value="AdminApplication&#xa;Spring Boot 主应用&#xa;端口: 8002" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="727" y="120" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Web层 -->
        <mxCell id="web-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="80" y="240" width="1500" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="web-title" value="Web控制层 (Controller)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="250" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- Agent Controller -->
        <mxCell id="agent-controller" value="AgentController&#xa;智能体管理&#xa;• 创建/更新/删除智能体&#xa;• 聊天记录管理&#xa;• 模板管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="120" y="300" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Device Controller -->
        <mxCell id="device-controller" value="DeviceController&#xa;设备管理&#xa;• 设备绑定/解绑&#xa;• 设备注册&#xa;• 设备信息更新" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="340" y="300" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Login Controller -->
        <mxCell id="login-controller" value="LoginController&#xa;登录认证管理&#xa;• 用户登录/注册&#xa;• 验证码&#xa;• 密码管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="560" y="300" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Model Controller -->
        <mxCell id="model-controller" value="ModelController&#xa;模型管理&#xa;• AI模型配置&#xa;• 模型提供商管理&#xa;• 模型参数设置" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="780" y="300" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Config Controller -->
        <mxCell id="config-controller" value="ConfigController&#xa;配置管理&#xa;• 系统参数配置&#xa;• 字典数据管理&#xa;• 服务配置" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1000" y="300" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- OTA Controller -->
        <mxCell id="ota-controller" value="OTAController&#xa;固件升级管理&#xa;• OTA版本管理&#xa;• 固件下发&#xa;• 升级状态" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1220" y="300" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Admin Controller -->
        <mxCell id="admin-controller" value="AdminController&#xa;系统管理&#xa;• 用户管理&#xa;• 权限控制&#xa;• 服务端操作" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1440" y="300" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- 业务服务层 -->
        <mxCell id="service-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="80" y="480" width="1500" height="200" as="geometry" />
        </mxCell>

        <mxCell id="service-title" value="业务服务层 (Service)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="490" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- Agent Service -->
        <mxCell id="agent-service" value="AgentService&#xa;• 智能体CRUD&#xa;• 权限检查&#xa;• 模板管理&#xa;• 插件映射" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="120" y="540" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Device Service -->
        <mxCell id="device-service" value="DeviceService&#xa;• 设备激活绑定&#xa;• MAC地址验证&#xa;• 设备状态管理&#xa;• 用户设备关联" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="300" y="540" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Security Service -->
        <mxCell id="security-service" value="SecurityService&#xa;• Token管理&#xa;• 密码加密&#xa;• 验证码服务&#xa;• 短信服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="480" y="540" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Model Service -->
        <mxCell id="model-service" value="ModelService&#xa;• 模型配置管理&#xa;• 提供商管理&#xa;• 语音模型配置&#xa;• 参数验证" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="660" y="540" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- System Service -->
        <mxCell id="system-service" value="SystemService&#xa;• 系统参数管理&#xa;• 字典数据服务&#xa;• 用户管理&#xa;• WebSocket管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="840" y="540" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Chat Service -->
        <mxCell id="chat-service" value="ChatService&#xa;• 聊天记录管理&#xa;• 会话管理&#xa;• 音频处理&#xa;• 历史数据统计" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="1020" y="540" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Voice Print Service -->
        <mxCell id="voice-service" value="VoicePrintService&#xa;• 声纹识别&#xa;• 音色管理&#xa;• 语音特征提取&#xa;• 身份验证" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="1200" y="540" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- MCP Service -->
        <mxCell id="mcp-service" value="McpAccessPointService&#xa;• MCP接入点管理&#xa;• JSON-RPC处理&#xa;• 协议转换&#xa;• 服务发现" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;" vertex="1" parent="1">
          <mxGeometry x="1380" y="540" width="160" height="100" as="geometry" />
        </mxCell>

        <!-- 数据访问层 -->
        <mxCell id="dao-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="80" y="720" width="1500" height="140" as="geometry" />
        </mxCell>

        <mxCell id="dao-title" value="数据访问层 (DAO/Mapper)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="730" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- Agent DAO -->
        <mxCell id="agent-dao" value="AgentDao&#xa;AgentTemplateDao&#xa;AgentVoicePrintDao" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="120" y="770" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- Device DAO -->
        <mxCell id="device-dao" value="DeviceDao&#xa;OtaDao" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="300" y="770" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- System DAO -->
        <mxCell id="system-dao" value="SysUserDao&#xa;SysParamsDao&#xa;SysDictDataDao&#xa;SysUserTokenDao" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="480" y="770" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- Model DAO -->
        <mxCell id="model-dao" value="ModelConfigDao&#xa;ModelProviderDao" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="660" y="770" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- Chat DAO -->
        <mxCell id="chat-dao" value="AiAgentChatHistoryDao&#xa;AiAgentChatAudioDao" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="840" y="770" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Plugin DAO -->
        <mxCell id="plugin-dao" value="AgentPluginMappingMapper&#xa;TimbreDao" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1040" y="770" width="180" height="70" as="geometry" />
        </mxCell>

        <!-- 基础设施层 -->
        <mxCell id="infra-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#1890ff;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="80" y="900" width="1500" height="200" as="geometry" />
        </mxCell>

        <mxCell id="infra-title" value="基础设施和中间件层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="910" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- Spring Boot 框架 -->
        <mxCell id="spring-boot" value="Spring Boot 3.4.3&#xa;• Spring Web MVC&#xa;• Spring AOP&#xa;• Spring Validation&#xa;• Spring Context" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" vertex="1" parent="1">
          <mxGeometry x="120" y="960" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Spring Security -->
        <mxCell id="spring-security" value="Apache Shiro 2.0.2&#xa;• 认证授权&#xa;• Token管理&#xa;• 权限控制&#xa;• Session管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" vertex="1" parent="1">
          <mxGeometry x="330" y="960" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- 数据库连接 -->
        <mxCell id="database-conn" value="数据库连接&#xa;• MyBatis Plus 3.5.5&#xa;• Druid 连接池&#xa;• MySQL Connector&#xa;• Liquibase 迁移" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" vertex="1" parent="1">
          <mxGeometry x="540" y="960" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Redis 缓存 -->
        <mxCell id="redis-cache" value="Redis 缓存&#xa;• Spring Data Redis&#xa;• 参数缓存&#xa;• Token缓存&#xa;• 验证码缓存" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" vertex="1" parent="1">
          <mxGeometry x="750" y="960" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- WebSocket 通信 -->
        <mxCell id="websocket-comm" value="WebSocket通信&#xa;• Spring WebSocket&#xa;• 实时消息推送&#xa;• 服务端操作&#xa;• 客户端管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" vertex="1" parent="1">
          <mxGeometry x="960" y="960" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- 第三方服务 -->
        <mxCell id="third-party" value="第三方集成&#xa;• 阿里云SMS&#xa;• HuTool工具包&#xa;• Knife4j文档&#xa;• Easy Captcha" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" vertex="1" parent="1">
          <mxGeometry x="1170" y="960" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- JSON-RPC -->
        <mxCell id="json-rpc" value="JSON-RPC 2.0&#xa;• MCP协议支持&#xa;• 接入点管理&#xa;• 协议转换&#xa;• 远程调用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;" vertex="1" parent="1">
          <mxGeometry x="1380" y="960" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- 数据存储层 -->
        <mxCell id="storage-layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="80" y="1140" width="1500" height="120" as="geometry" />
        </mxCell>

        <mxCell id="storage-title" value="数据存储层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="1150" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- MySQL 数据库 -->
        <mxCell id="mysql-db" value="MySQL 数据库&#xa;• 用户数据&#xa;• 智能体配置&#xa;• 设备信息&#xa;• 聊天记录&#xa;• 系统参数" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="200" y="1190" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Redis 存储 -->
        <mxCell id="redis-storage" value="Redis 存储&#xa;• Token缓存&#xa;• 验证码存储&#xa;• 参数缓存&#xa;• 会话数据" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="500" y="1190" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- 文件存储 -->
        <mxCell id="file-storage" value="文件存储&#xa;• OTA固件文件&#xa;• 音频文件&#xa;• 配置文件&#xa;• 日志文件" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="800" y="1190" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- 外部接口 -->
        <mxCell id="external-apis" value="外部接口&#xa;• 阿里云SMS API&#xa;• xiaozhi-server接口&#xa;• MCP服务接口&#xa;• 第三方AI模型API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;" vertex="1" parent="1">
          <mxGeometry x="1100" y="1190" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- 核心业务流程 -->
        <mxCell id="business-flows" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2e6;strokeColor=#f57c00;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="80" y="1300" width="1500" height="300" as="geometry" />
        </mxCell>

        <mxCell id="business-flows-title" value="核心业务流程" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="1310" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- 用户认证流程 -->
        <mxCell id="auth-flow" value="用户认证流程&#xa;1. 验证码生成&#xa;2. 用户名密码验证&#xa;3. Token生成&#xa;4. 权限检查&#xa;5. Session管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;" vertex="1" parent="1">
          <mxGeometry x="120" y="1350" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- 设备管理流程 -->
        <mxCell id="device-flow" value="设备管理流程&#xa;1. 设备注册(MAC)&#xa;2. 验证码生成&#xa;3. 设备绑定&#xa;4. 智能体关联&#xa;5. 状态同步" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;" vertex="1" parent="1">
          <mxGeometry x="330" y="1350" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- 智能体管理流程 -->
        <mxCell id="agent-flow" value="智能体管理流程&#xa;1. 模板选择&#xa;2. 智能体创建&#xa;3. 参数配置&#xa;4. 插件绑定&#xa;5. 权限设置" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;" vertex="1" parent="1">
          <mxGeometry x="540" y="1350" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- 对话管理流程 -->
        <mxCell id="chat-flow" value="对话管理流程&#xa;1. 会话创建&#xa;2. 消息记录&#xa;3. 音频处理&#xa;4. 历史查询&#xa;5. 数据统计" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;" vertex="1" parent="1">
          <mxGeometry x="750" y="1350" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- 配置管理流程 -->
        <mxCell id="config-flow" value="配置管理流程&#xa;1. 参数验证&#xa;2. 类型检查&#xa;3. 缓存更新&#xa;4. 配置下发&#xa;5. 实时同步" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;" vertex="1" parent="1">
          <mxGeometry x="960" y="1350" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- MCP集成流程 -->
        <mxCell id="mcp-flow" value="MCP集成流程&#xa;1. 接入点注册&#xa;2. JSON-RPC调用&#xa;3. 协议转换&#xa;4. 响应处理&#xa;5. 状态管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;" vertex="1" parent="1">
          <mxGeometry x="1170" y="1350" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- 系统监控流程 -->
        <mxCell id="monitor-flow" value="系统监控流程&#xa;1. 服务健康检查&#xa;2. 性能数据收集&#xa;3. 异常监控&#xa;4. 日志管理&#xa;5. 告警通知" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;" vertex="1" parent="1">
          <mxGeometry x="1380" y="1350" width="180" height="120" as="geometry" />
        </mxCell>

        <!-- 连接线 -->
        
        <!-- 主应用到Controller -->
        <mxCell id="flow1" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#60a917;strokeColor=#2D7600;" edge="1" parent="1" source="main-app" target="agent-controller">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="727" y="180" as="sourcePoint" />
            <mxPoint x="210" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Controller到Service -->
        <mxCell id="flow2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#1ba1e2;strokeColor=#006EAF;" edge="1" parent="1" source="agent-controller" target="agent-service">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="400" as="sourcePoint" />
            <mxPoint x="190" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#1ba1e2;strokeColor=#006EAF;" edge="1" parent="1" source="device-controller" target="device-service">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="430" y="400" as="sourcePoint" />
            <mxPoint x="370" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#1ba1e2;strokeColor=#006EAF;" edge="1" parent="1" source="login-controller" target="security-service">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="650" y="400" as="sourcePoint" />
            <mxPoint x="550" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Service到DAO -->
        <mxCell id="flow5" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#6a00ff;strokeColor=#3700CC;" edge="1" parent="1" source="agent-service" target="agent-dao">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="640" as="sourcePoint" />
            <mxPoint x="190" y="770" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow6" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#6a00ff;strokeColor=#3700CC;" edge="1" parent="1" source="device-service" target="device-dao">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="640" as="sourcePoint" />
            <mxPoint x="370" y="770" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- DAO到数据存储 -->
        <mxCell id="flow7" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#e85d75;strokeColor=#B20000;" edge="1" parent="1" source="agent-dao" target="mysql-db">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="840" as="sourcePoint" />
            <mxPoint x="300" y="1190" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow8" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#e85d75;strokeColor=#B20000;" edge="1" parent="1" source="system-service" target="redis-storage">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="910" y="640" as="sourcePoint" />
            <mxPoint x="600" y="1190" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 基础设施连接 -->
        <mxCell id="flow9" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#008a00;strokeColor=#005700;" edge="1" parent="1" source="spring-security" target="login-controller">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="960" as="sourcePoint" />
            <mxPoint x="650" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 业务流程连接 -->
        <mxCell id="flow10" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#ff8c00;strokeColor=#D79B00;" edge="1" parent="1" source="auth-flow" target="login-controller">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="210" y="1350" as="sourcePoint" />
            <mxPoint x="650" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow11" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#ff8c00;strokeColor=#D79B00;" edge="1" parent="1" source="device-flow" target="device-controller">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="1350" as="sourcePoint" />
            <mxPoint x="430" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 图例 -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="80" y="1640" width="800" height="200" as="geometry" />
        </mxCell>

        <mxCell id="legend-title" value="图例说明" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="1650" width="100" height="30" as="geometry" />
        </mxCell>

        <!-- 图例项目 -->
        <mxCell id="legend1" value="Spring Boot应用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="100" y="1690" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend2" value="控制层Controller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="210" y="1690" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend3" value="业务层Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1ffc7;strokeColor=#67ab36;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="320" y="1690" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend4" value="数据访问DAO" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffd6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="430" y="1690" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend5" value="基础设施" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4f1ff;strokeColor=#1f85de;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="540" y="1690" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend6" value="数据存储" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc4125;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="650" y="1690" width="90" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend7" value="业务流程" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff7e6;strokeColor=#ff8c00;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="760" y="1690" width="90" height="30" as="geometry" />
        </mxCell>

        <!-- 数据流连接线说明 -->
        <mxCell id="flow-legend1" value="主要调用" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="120" y="1750" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="flow-line1" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#60a917;strokeColor=#2D7600;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="1760" as="sourcePoint" />
            <mxPoint x="120" y="1760" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow-legend2" value="层间调用" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="220" y="1750" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="flow-line2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#1ba1e2;strokeColor=#006EAF;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="200" y="1760" as="sourcePoint" />
            <mxPoint x="220" y="1760" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow-legend3" value="数据访问" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="320" y="1750" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="flow-line3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#6a00ff;strokeColor=#3700CC;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="1760" as="sourcePoint" />
            <mxPoint x="320" y="1760" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow-legend4" value="存储操作" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="420" y="1750" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="flow-line4" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;fillColor=#e85d75;strokeColor=#B20000;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="1760" as="sourcePoint" />
            <mxPoint x="420" y="1760" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow-legend5" value="基础设施" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="520" y="1750" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="flow-line5" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#008a00;strokeColor=#005700;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="1760" as="sourcePoint" />
            <mxPoint x="520" y="1760" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow-legend6" value="业务流程" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="620" y="1750" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="flow-line6" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;fillColor=#ff8c00;strokeColor=#D79B00;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="1760" as="sourcePoint" />
            <mxPoint x="620" y="1760" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- 技术栈说明 -->
        <mxCell id="tech-stack-title" value="核心技术栈" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="980" y="1650" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="tech-stack-content" value="• Java 21 + Spring Boot 3.4.3&#xa;• MyBatis Plus 3.5.5 + MySQL&#xa;• Apache Shiro 2.0.2 + Redis&#xa;• WebSocket + Knife4j API文档&#xa;• Liquibase数据库迁移&#xa;• HuTool工具包 + 阿里云SMS&#xa;• JSON-RPC 2.0 + MCP协议" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="920" y="1690" width="220" height="140" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>